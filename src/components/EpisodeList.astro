---
import FormattedDate from '../components/FormattedDate';
import FullPlayButton from '../components/FullPlayButton';
import type { Episode, Show } from '../lib/rss';
import { dasherize } from '../utils/dasherize';

export interface Props {
  episodes: Array<Episode>;
  show: Show;
  basePath?: string;
}

const { episodes, show, basePath = '' } = Astro.props;
---

<ul aria-label="EpisodeList">
  {
    episodes.map((episode) => {
      return (
        <li class="dark:border-dark-border border-b">
          <div class="flex w-full flex-col py-12 lg:flex-row">
            <img
              alt={`${episode.title} - episode art`}
              aria-hidden="true"
              class="mb-3 block h-20 w-20 rounded-md lg:mr-6"
              height={80}
              loading="lazy"
              src={episode.episodeThumbnail ?? show.image}
              width={80}
            />

            <div class="flex flex-col">
              <FormattedDate date={new Date(episode.published)} />

              <h2 class="text-light-text-heading my-2 text-lg font-bold dark:text-white">
                <a
                  href={`${basePath}/${episode.episodeSlug}`}
                  style={
                    'view-transition-name: var(--should-vt); --vt-name: vt-' +
                    dasherize(episode.title)
                  }
                >
                  {episode.episodeNumber}: {episode.title}
                </a>
              </h2>

              <p class="mb-5">{episode.description}</p>

              <div class="flex items-center gap-6 text-sm">
                <FullPlayButton
                  client:visible
                  episode={{
                    audio: episode.audio,
                    episodeNumber: episode.episodeNumber,
                    id: episode.id,
                    title: episode.title
                  }}
                />

                <a
                  class="text-light-text-heading font-bold dark:text-white"
                  href={`${basePath}/${episode.episodeSlug}`}
                >
                  Show notes
                </a>

                <a
                  class="text-light-text-heading dark:text-white hover:opacity-70 transition-opacity"
                  href={episode.audio.src}
                  download
                  title="Download episode"
                  aria-label="Download episode"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="7 10 12 15 17 10"/>
                    <line x1="12" y1="15" x2="12" y2="3"/>
                  </svg>
                </a>
              </div>
            </div>
          </div>
        </li>
      );
    })
  }
</ul>
